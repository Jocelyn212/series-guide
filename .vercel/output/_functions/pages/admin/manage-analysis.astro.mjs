import { c as createComponent, b as createAstro, a as renderTemplate, e as addAttribute, r as renderHead } from '../../chunks/astro/server_CPsB3qD4.mjs';
import { g as getServerAuthUser } from '../../chunks/auth_BB3BAWhE.mjs';
import { a as getAnalisis } from '../../chunks/mongo_CASFip9t.mjs';
/* empty css                                              */
export { renderers } from '../../renderers.mjs';

var __freeze = Object.freeze;
var __defProp = Object.defineProperty;
var __template = (cooked, raw) => __freeze(__defProp(cooked, "raw", { value: __freeze(raw || cooked.slice()) }));
var _a;
const $$Astro = createAstro();
const $$ManageAnalysis = createComponent(async ($$result, $$props, $$slots) => {
  const Astro2 = $$result.createAstro($$Astro, $$props, $$slots);
  Astro2.self = $$ManageAnalysis;
  const user = getServerAuthUser(Astro2.request);
  if (!user || user.role !== "admin") {
    return Astro2.redirect("/login");
  }
  let analysis = [];
  let error = "";
  try {
    analysis = await getAnalisis();
  } catch (err) {
    error = "Error cargando an\xE1lisis";
  }
  return renderTemplate(_a || (_a = __template(['<html lang="es" data-astro-cid-qmr4o3ka> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Gestionar An\xE1lisis - Admin SeriesGuide</title><link rel="icon" type="image/svg+xml" href="/favicon.svg">', '</head> <body class="bg-gray-900 min-h-screen" data-astro-cid-qmr4o3ka> <div class="container mx-auto px-4 py-8" data-astro-cid-qmr4o3ka> <!-- Header --> <div class="flex justify-between items-center mb-8" data-astro-cid-qmr4o3ka> <div data-astro-cid-qmr4o3ka> <h1 class="text-3xl font-bold text-white mb-2" data-astro-cid-qmr4o3ka>Gestionar An\xE1lisis</h1> <p class="text-gray-400" data-astro-cid-qmr4o3ka>\nEdita, elimina y administra los an\xE1lisis existentes\n</p> </div> <div class="flex gap-4" data-astro-cid-qmr4o3ka> <a href="/admin/add-analysis" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium transition-colors" data-astro-cid-qmr4o3ka>\n+ Nuevo An\xE1lisis\n</a> <a href="/admin" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg font-medium transition-colors" data-astro-cid-qmr4o3ka>\n\u2190 Volver\n</a> </div> </div> <!-- Estad\xEDsticas --> <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8" data-astro-cid-qmr4o3ka> <div class="bg-gray-800 p-6 rounded-lg border border-gray-700" data-astro-cid-qmr4o3ka> <h3 class="text-sm font-medium text-gray-400 mb-2" data-astro-cid-qmr4o3ka>Total An\xE1lisis</h3> <p class="text-3xl font-bold text-white" data-astro-cid-qmr4o3ka>', '</p> </div> <div class="bg-gray-800 p-6 rounded-lg border border-gray-700" data-astro-cid-qmr4o3ka> <h3 class="text-sm font-medium text-gray-400 mb-2" data-astro-cid-qmr4o3ka>Publicados</h3> <p class="text-3xl font-bold text-green-400" data-astro-cid-qmr4o3ka> ', ' </p> </div> <div class="bg-gray-800 p-6 rounded-lg border border-gray-700" data-astro-cid-qmr4o3ka> <h3 class="text-sm font-medium text-gray-400 mb-2" data-astro-cid-qmr4o3ka>Borradores</h3> <p class="text-3xl font-bold text-yellow-400" data-astro-cid-qmr4o3ka> ', ' </p> </div> <div class="bg-gray-800 p-6 rounded-lg border border-gray-700" data-astro-cid-qmr4o3ka> <h3 class="text-sm font-medium text-gray-400 mb-2" data-astro-cid-qmr4o3ka>Total Vistas</h3> <p class="text-3xl font-bold text-blue-400" data-astro-cid-qmr4o3ka> ', ' </p> </div> </div> <!-- Buscador --> <div class="mb-6" data-astro-cid-qmr4o3ka> <input type="text" id="search" placeholder="Buscar an\xE1lisis por t\xEDtulo, contenido, tags..." class="w-full bg-gray-800 text-white rounded-lg px-4 py-3 border border-gray-700 focus:border-blue-500 focus:outline-none" data-astro-cid-qmr4o3ka> </div> <!-- Lista de An\xE1lisis --> ', ' </div> <script>\n      // Event delegation para los botones\n      document.addEventListener("click", function (e) {\n        const target = e.target;\n        if (target && target.dataset) {\n          if (target.dataset.action === "edit") {\n            editAnalysis(target.dataset.id);\n          } else if (target.dataset.action === "delete") {\n            deleteAnalysis(target.dataset.id, target.dataset.title);\n          }\n        }\n      });\n\n      // B\xFAsqueda en tiempo real\n      const searchInput = document.getElementById("search");\n      if (searchInput) {\n        searchInput.addEventListener("input", function (e) {\n          const target = e.target;\n          if (target && target.value !== undefined) {\n            const searchTerm = target.value.toLowerCase();\n            const rows = document.querySelectorAll(".analysis-row");\n\n            rows.forEach((row) => {\n              try {\n                const analysisData = JSON.parse(row.dataset.analysis || "{}");\n                const searchText =\n                  `${analysisData.title || ""} ${analysisData.content || ""} ${(analysisData.tags || []).join(" ")} ${analysisData.excerpt || ""}`.toLowerCase();\n\n                if (searchText.includes(searchTerm)) {\n                  row.style.display = "";\n                } else {\n                  row.style.display = "none";\n                }\n              } catch (error) {\n                console.error("Error parsing analysis data:", error);\n              }\n            });\n          }\n        });\n      }\n\n      function editAnalysis(id) {\n        if (!id) {\n          alert("Error: ID de an\xE1lisis no v\xE1lido");\n          return;\n        }\n        // Por ahora solo mostrar alerta, luego se puede implementar modal\n        alert(`Funci\xF3n de edici\xF3n para an\xE1lisis ID: ${id} - Por implementar`);\n      }\n\n      function deleteAnalysis(id, title) {\n        if (!id) {\n          alert("Error: ID de an\xE1lisis no v\xE1lido");\n          return;\n        }\n\n        if (\n          !confirm(\n            `\xBFEst\xE1s seguro de que quieres eliminar el an\xE1lisis "${title || "Sin t\xEDtulo"}"? Esta acci\xF3n no se puede deshacer.`\n          )\n        ) {\n          return;\n        }\n\n        fetch("/api/analysis", {\n          method: "DELETE",\n          headers: {\n            "Content-Type": "application/json",\n          },\n          body: JSON.stringify({ id }),\n        })\n          .then((response) => {\n            if (!response.ok) {\n              throw new Error(`HTTP error! status: ${response.status}`);\n            }\n            return response.json();\n          })\n          .then((data) => {\n            if (data.success) {\n              alert("An\xE1lisis eliminado exitosamente");\n              location.reload();\n            } else {\n              alert(\n                "Error eliminando el an\xE1lisis: " +\n                  (data.error || "Error desconocido")\n              );\n            }\n          })\n          .catch((error) => {\n            console.error("Error:", error);\n            alert("Error eliminando el an\xE1lisis: " + error.message);\n          });\n      }\n    <\/script> </body> </html>'], ['<html lang="es" data-astro-cid-qmr4o3ka> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Gestionar An\xE1lisis - Admin SeriesGuide</title><link rel="icon" type="image/svg+xml" href="/favicon.svg">', '</head> <body class="bg-gray-900 min-h-screen" data-astro-cid-qmr4o3ka> <div class="container mx-auto px-4 py-8" data-astro-cid-qmr4o3ka> <!-- Header --> <div class="flex justify-between items-center mb-8" data-astro-cid-qmr4o3ka> <div data-astro-cid-qmr4o3ka> <h1 class="text-3xl font-bold text-white mb-2" data-astro-cid-qmr4o3ka>Gestionar An\xE1lisis</h1> <p class="text-gray-400" data-astro-cid-qmr4o3ka>\nEdita, elimina y administra los an\xE1lisis existentes\n</p> </div> <div class="flex gap-4" data-astro-cid-qmr4o3ka> <a href="/admin/add-analysis" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium transition-colors" data-astro-cid-qmr4o3ka>\n+ Nuevo An\xE1lisis\n</a> <a href="/admin" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg font-medium transition-colors" data-astro-cid-qmr4o3ka>\n\u2190 Volver\n</a> </div> </div> <!-- Estad\xEDsticas --> <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8" data-astro-cid-qmr4o3ka> <div class="bg-gray-800 p-6 rounded-lg border border-gray-700" data-astro-cid-qmr4o3ka> <h3 class="text-sm font-medium text-gray-400 mb-2" data-astro-cid-qmr4o3ka>Total An\xE1lisis</h3> <p class="text-3xl font-bold text-white" data-astro-cid-qmr4o3ka>', '</p> </div> <div class="bg-gray-800 p-6 rounded-lg border border-gray-700" data-astro-cid-qmr4o3ka> <h3 class="text-sm font-medium text-gray-400 mb-2" data-astro-cid-qmr4o3ka>Publicados</h3> <p class="text-3xl font-bold text-green-400" data-astro-cid-qmr4o3ka> ', ' </p> </div> <div class="bg-gray-800 p-6 rounded-lg border border-gray-700" data-astro-cid-qmr4o3ka> <h3 class="text-sm font-medium text-gray-400 mb-2" data-astro-cid-qmr4o3ka>Borradores</h3> <p class="text-3xl font-bold text-yellow-400" data-astro-cid-qmr4o3ka> ', ' </p> </div> <div class="bg-gray-800 p-6 rounded-lg border border-gray-700" data-astro-cid-qmr4o3ka> <h3 class="text-sm font-medium text-gray-400 mb-2" data-astro-cid-qmr4o3ka>Total Vistas</h3> <p class="text-3xl font-bold text-blue-400" data-astro-cid-qmr4o3ka> ', ' </p> </div> </div> <!-- Buscador --> <div class="mb-6" data-astro-cid-qmr4o3ka> <input type="text" id="search" placeholder="Buscar an\xE1lisis por t\xEDtulo, contenido, tags..." class="w-full bg-gray-800 text-white rounded-lg px-4 py-3 border border-gray-700 focus:border-blue-500 focus:outline-none" data-astro-cid-qmr4o3ka> </div> <!-- Lista de An\xE1lisis --> ', ' </div> <script>\n      // Event delegation para los botones\n      document.addEventListener("click", function (e) {\n        const target = e.target;\n        if (target && target.dataset) {\n          if (target.dataset.action === "edit") {\n            editAnalysis(target.dataset.id);\n          } else if (target.dataset.action === "delete") {\n            deleteAnalysis(target.dataset.id, target.dataset.title);\n          }\n        }\n      });\n\n      // B\xFAsqueda en tiempo real\n      const searchInput = document.getElementById("search");\n      if (searchInput) {\n        searchInput.addEventListener("input", function (e) {\n          const target = e.target;\n          if (target && target.value !== undefined) {\n            const searchTerm = target.value.toLowerCase();\n            const rows = document.querySelectorAll(".analysis-row");\n\n            rows.forEach((row) => {\n              try {\n                const analysisData = JSON.parse(row.dataset.analysis || "{}");\n                const searchText =\n                  \\`\\${analysisData.title || ""} \\${analysisData.content || ""} \\${(analysisData.tags || []).join(" ")} \\${analysisData.excerpt || ""}\\`.toLowerCase();\n\n                if (searchText.includes(searchTerm)) {\n                  row.style.display = "";\n                } else {\n                  row.style.display = "none";\n                }\n              } catch (error) {\n                console.error("Error parsing analysis data:", error);\n              }\n            });\n          }\n        });\n      }\n\n      function editAnalysis(id) {\n        if (!id) {\n          alert("Error: ID de an\xE1lisis no v\xE1lido");\n          return;\n        }\n        // Por ahora solo mostrar alerta, luego se puede implementar modal\n        alert(\\`Funci\xF3n de edici\xF3n para an\xE1lisis ID: \\${id} - Por implementar\\`);\n      }\n\n      function deleteAnalysis(id, title) {\n        if (!id) {\n          alert("Error: ID de an\xE1lisis no v\xE1lido");\n          return;\n        }\n\n        if (\n          !confirm(\n            \\`\xBFEst\xE1s seguro de que quieres eliminar el an\xE1lisis "\\${title || "Sin t\xEDtulo"}"? Esta acci\xF3n no se puede deshacer.\\`\n          )\n        ) {\n          return;\n        }\n\n        fetch("/api/analysis", {\n          method: "DELETE",\n          headers: {\n            "Content-Type": "application/json",\n          },\n          body: JSON.stringify({ id }),\n        })\n          .then((response) => {\n            if (!response.ok) {\n              throw new Error(\\`HTTP error! status: \\${response.status}\\`);\n            }\n            return response.json();\n          })\n          .then((data) => {\n            if (data.success) {\n              alert("An\xE1lisis eliminado exitosamente");\n              location.reload();\n            } else {\n              alert(\n                "Error eliminando el an\xE1lisis: " +\n                  (data.error || "Error desconocido")\n              );\n            }\n          })\n          .catch((error) => {\n            console.error("Error:", error);\n            alert("Error eliminando el an\xE1lisis: " + error.message);\n          });\n      }\n    <\/script> </body> </html>'])), renderHead(), analysis.length, analysis.filter((a) => a.status === "published").length, analysis.filter((a) => a.status === "draft").length, analysis.reduce((sum, a) => sum + (a.views || 0), 0), error ? renderTemplate`<div class="bg-red-500 text-white p-4 rounded-lg mb-6" data-astro-cid-qmr4o3ka>${error}</div>` : renderTemplate`<div class="bg-gray-800 rounded-lg border border-gray-700 overflow-hidden" data-astro-cid-qmr4o3ka> <div class="overflow-x-auto" data-astro-cid-qmr4o3ka> <table class="w-full" data-astro-cid-qmr4o3ka> <thead class="bg-gray-700" data-astro-cid-qmr4o3ka> <tr data-astro-cid-qmr4o3ka> <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider" data-astro-cid-qmr4o3ka>
An√°lisis
</th> <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider" data-astro-cid-qmr4o3ka>
Estado
</th> <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider" data-astro-cid-qmr4o3ka>
Fecha
</th> <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider" data-astro-cid-qmr4o3ka>
Vistas
</th> <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider" data-astro-cid-qmr4o3ka>
Likes
</th> <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider" data-astro-cid-qmr4o3ka>
Acciones
</th> </tr> </thead> <tbody class="divide-y divide-gray-700" id="analysisTable" data-astro-cid-qmr4o3ka> ${analysis.map((analisis) => renderTemplate`<tr class="hover:bg-gray-700 transition-colors analysis-row"${addAttribute(JSON.stringify(analisis), "data-analysis")} data-astro-cid-qmr4o3ka> <td class="px-6 py-4" data-astro-cid-qmr4o3ka> <div data-astro-cid-qmr4o3ka> <div class="text-sm font-medium text-white" data-astro-cid-qmr4o3ka> ${analisis.title} </div> <div class="text-sm text-gray-400" data-astro-cid-qmr4o3ka> ${analisis.excerpt ? analisis.excerpt.substring(0, 100) + "..." : "Sin extracto"} </div> <div class="flex flex-wrap gap-1 mt-1" data-astro-cid-qmr4o3ka> ${analisis.tags && analisis.tags.slice(0, 3).map((tag) => renderTemplate`<span class="bg-blue-900 text-blue-200 px-2 py-1 text-xs rounded" data-astro-cid-qmr4o3ka> ${tag} </span>`)} </div> </div> </td> <td class="px-6 py-4 whitespace-nowrap" data-astro-cid-qmr4o3ka> <span${addAttribute(`inline-flex px-2 py-1 text-xs font-semibold rounded-full ${analisis.status === "published" ? "bg-green-900 text-green-200" : "bg-yellow-900 text-yellow-200"}`, "class")} data-astro-cid-qmr4o3ka> ${analisis.status === "published" ? "Publicado" : "Borrador"} </span> </td> <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300" data-astro-cid-qmr4o3ka> ${new Date(analisis.createdAt).toLocaleDateString(
    "es-ES"
  )} </td> <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300" data-astro-cid-qmr4o3ka> ${analisis.views || 0} </td> <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300" data-astro-cid-qmr4o3ka> ${analisis.likes || 0} </td> <td class="px-6 py-4 whitespace-nowrap text-sm" data-astro-cid-qmr4o3ka> <div class="flex space-x-2" data-astro-cid-qmr4o3ka> <button data-action="edit"${addAttribute(analisis._id, "data-id")} class="bg-yellow-600 hover:bg-yellow-700 text-white px-3 py-1 rounded text-xs font-medium transition-colors" data-astro-cid-qmr4o3ka>
Editar
</button> <button data-action="delete"${addAttribute(analisis._id, "data-id")}${addAttribute(analisis.title, "data-title")} class="bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-xs font-medium transition-colors" data-astro-cid-qmr4o3ka>
Eliminar
</button> <a${addAttribute(`/analisis#${analisis.slug}`, "href")} target="_blank" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-xs font-medium transition-colors" data-astro-cid-qmr4o3ka>
Ver
</a> </div> </td> </tr>`)} </tbody> </table> </div> </div>`);
}, "/Users/jocelyncastro/Desktop/ProyectoSeries/series-guide/src/pages/admin/manage-analysis.astro", void 0);

const $$file = "/Users/jocelyncastro/Desktop/ProyectoSeries/series-guide/src/pages/admin/manage-analysis.astro";
const $$url = "/admin/manage-analysis";

const _page = /*#__PURE__*/Object.freeze(/*#__PURE__*/Object.defineProperty({
  __proto__: null,
  default: $$ManageAnalysis,
  file: $$file,
  url: $$url
}, Symbol.toStringTag, { value: 'Module' }));

const page = () => _page;

export { page };
